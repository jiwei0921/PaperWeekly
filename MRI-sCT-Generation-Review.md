# A review of substitute CT generation for MRI-only radiation therapy

## 0. Abstract

Radiotherapy based on magnetic resonance imaging as the sole modality (MRI-only RT) is an area of growing scientific interest due to the increasing use of MRI for both target and normal tissue delineation and the development of MR based delivery systems. One major issue in MRI-only RT is the assignment of electron densities (ED) to MRI scans for dose calculation and a similar need for attenuation correction can be found for hybrid PET/MR systems. The ED assigned MRI scan is here named a substitute CT (sCT). In this review, we report on a collection of typical performance values for a number of main approaches encountered in the literature for sCT generation as compared to CT. A literature search in the Scopus database resulted in 254 papers which were included in this investigation. A final number of 50 contributions which fulfilled all inclusion criteria were categorized according to applied method, MRI sequence/contrast involved, number of subjects included and anatomical site investigated. The latter included brain, torso, prostate and phantoms. The contributions geometric and/or dosimetric performance metrics were also noted. The majority of studies are carried out on the brain for 5–10 patients with PET/MR applications in mind using a voxel based method. T1 weighted images are most commonly applied. The overall dosimetric agreement is in the order of 0.3–2.5%. A strict gamma criterion of 1% and 1mm has a range of passing rates from 68 to 94% while less strict criteria show pass rates > 98%. The mean absolute error (MAE) is between 80 and 200 HU for the brain and around 40 HU for the prostate. The Dice score for bone is between 0.5 and 0.95. The specificity and sensitivity is reported in the upper 80s% for both quantities and correctly classified voxels average around 84%. The review shows that a variety of promising approaches exist that seem clinical acceptable even with standard clinical MRI sequences. A consistent reference frame for method benchmarking is probably necessary to move the field further towards a widespread clinical implementation.

由于越来越多的使用MRI进行目标和正常组织的勾画，以及基于MRI的投放系统的发展，基于单模态MRI的放射治疗(MRI-only CT)的研究兴趣日渐增加。其中一个主要的问题是为MRI的扫描图像指定电子密度，以进行剂量计算，在混合PET/MR系统中，也有类似的衰减修正的需要。指定了电子密度的MRI扫描，这里命名为替代CT(sCT)。在本文的回顾中，我们给出了文献中几种常见的sCT生成方法中，与CT相比的典型表现值。在Scopus数据库中搜索到了254篇文献，本文对这些文献进行了研究。最后筛选出了50篇符合条件的文献，根据使用的方法、涉及到的MRI序列/对比度、包含的目标数量和研究的解剖位置进行了分类。后者包括脑部、躯干、前列腺和模体。还标出了贡献的几何性能或剂量性能。主要的研究都是在脑部进行的，对5-10个病人进行PET/MR成像，使用基于体素的方法。最常见的是使用T1加权的图像。总体的剂量协议是0.3–2.5%的量级。在严格的gamma准则即1%和1mm下，通过率范围在68%到94%，而不太严格的准则下，通过率大于98%。脑部的平均绝对误差(MAE)是在80HU与200HU之间，对于前列腺大约在40HU左右。骨骼的Dice分数在0.5和0.95之间。对于上半身的80s%，给出了专门性和敏感度的报告，在数量上和正确分类的体素在84%左右。本文表明，有很多已有的方法，即使是用标准的临床MRI序列，也是在临床上可以接受的。可能很需要一个一致的方法基准测试参考框架，以推动这个领域进一步达到临床实现的水平。

## 1. Introduction

Dose calculations performed on scans from magnetic resonance imaging (MRI) were first reported around the millennium when MRI emerged as a complimentary modality to computed tomography (CT) in the delineation step of the radiotherapy (RT) chain [1, 2]. As MRI provides superior soft tissue contrast and delineation precision as compared to CT [3–8], the concept of carrying out all steps of the RT chain on MRI as the sole modality, so-called MRI-only RT, could provide a favorable workflow. MRI-only RT would further remove a systematic registration error when transferring MRI delineated structures to the CT which has been reported to be in the order of 2–5 mm for various treatment sites [9–13]. As CT is used for positioning of the patient at treatment, registration errors introduce a spatial systematic uncertainty. The dosimetric impact of a systematic error will increase when the radiation is aimed at small structures or when the target is close to sensitive organs. This could be the case for small tumors or the hippocampus in the brain [14] with a structure radius in the order of a possible registration error or when a standard PTV or PRV margin has to be compromised to maintain an acceptable therapeutic ratio. An example of the MRI to CT registration variability for a prostate and nasopharynx case is illustrated in Fig. 1.

用MRI扫描进行的剂量计算，最早在2000年左右有所报导，那时MRI刚刚兴起作为CT的一种补充模态，用做放射治疗的勾画步骤。由于MRI可以给出软组织很高的对比度，与CT相比，可以得到更好的勾画精度，只使用单模态的MRI进行放射治疗的所有步骤，也就是MRI-only RT的概念，可以给出很好的工作流。MRI-only RT还可以移除系统性的配准误差，这个误差由将MRI勾画的结构迁移到CT中引入，据文章报导说，对于不同的治疗部位，这个误差有2-5mm之多。由于CT用于病人治疗的摆位，配准误差就成为了一种空间上的系统不确定性。在放射的目标是小型结构时，或目标与敏感器官很接近时，这种系统性误差的剂量影响还会增加。这可能是小型肿瘤，或大脑中的海马体，或一个标准的PTV或PRV需要折中以保持可接受的治疗率。MRI到CT的配准变化，在前列腺和鼻咽部位的例子，如图1所示。

In addition, MRI-only will decrease the number of scans and associated patient discomfort, and, reduce the planning related costs [15]. The benefits of MRI-only RT would further increase in a workflow with repeated imaging, e.g. weekly scans, for response assessment and/or treatment adaptation.

另外，MRI-only会降低需要的扫描数量，降低病人的不舒适感，并降低与计划相关的代价。MRI-only RT的好处在重复成像的工作流中还会进一步增加，如，每周扫描，进行响应评估和/或治疗调整。

A number of concerns related to MRI-only RT exist. One major challenge of performing dose calculations on MRI is the lack of correspondence between the voxel intensity and the associated attenuation property of the tissue. Unlike CT images where the voxel intensity directly reflects the radiological characteristics of the tissue, MRI intensities rather correlate with tissue proton density and the magnetic relaxation, i.e. the inertia of the dipole moment [16]. This leads to voxel ambiguity for tissues such as bone and air which both appear dark on the MRI although they have very different attenuation coefficients. The focus of this review is strategies for dealing with this ambiguity. Further challenges constitute scanner induced geometrical distortions arising from gradient non-linearity and magnet inhomogeneities and patient induced artifacts such as susceptibility and chemical shifts [13]. Specific problems for algorithms converting the MRI signal into a CT number further constitute normalization of absolute signal intensities and data correction strategies such as bias field correction. These topics are considered out of scope of this review.

有几个与MRI-only RT相关的问题。进行剂量计算的一个主要挑战是，体素亮度与组织相关的衰减性质的对应性的缺乏。CT图像中，体素亮度直接反应了组织的放射学性质，与之不同的是，MRI的亮度反应的是组织的质子密度和磁场弛豫，即，偶极矩的惯性。对于骨骼和空气这样的组织来将，带来了体素的不明确性，它们在MRI中都是暗色的，但它们的衰减系数是非常不一样的。本文的焦点是处理这些疑议性的策略。进一步的挑战包括，扫描器带来的几何形变，这是由梯度的非线性和磁场的不均匀性造成的，还有病人引入的伪影，如磁化系数和化学成分的改变。将MRI信号转化成CT值的算法带来的具体问题包含，绝对信号值的归一化和数据纠正策略，如偏置场的纠正。这些问题不在本文的考虑范围之内。

The increased use of MRI for target and normal tissue delineation in RT in general and two device-driven events have facilitated scientific activity for assigning electron densities to MRI images. The first event is the commercial availability of clinical integrated hybrid PET/MRI systems around 2010-2011 [17]. Unlike traditional PET/CT systems where the CT scan is used for attenuation correction of the PET signal needed in quantitative PET volume estimates such as the standard uptake volume (SUV), attenuation coefficients need to be assigned to the MRI scan in hybrid PET/MRI systems to make a similar attenuation correction. The second event is the commercial availability of integrated MRI guided systems in external beam RT around 2014 [18]. These systems can provide MRI scans for patient setup based on soft tissues and monitor the tumor movement during treatment delivery. The systems would be able to calculate and adapt the dose distribution at each given fraction if a dose calculation can be performed on the MRI scan which requires electron densities to be assigned. The increased focus on MRI in RT and the introduction of the imaging and treatment devices is reflected in the number of publications as illustrated in Fig. 2.

在放射治疗中使用MRI进行目标和正常组织的勾画越来越多，以及两个设备驱动的事件，使得为MRI图像指定电子密度的科学活动得到促进。第一个事件是，临床上整合好的混合PET/MRI系统在2010-2011年已经有了商用系统。在传统的PET/CT系统中，CT扫描用于PET信号的衰减修正，这在定量的PET体估计中是需要的，如标准摄取体(SUV)，与之不同的是，在混合PET/MRI系统中，需要给MRI指定衰减系数，进行类似的衰减修正。第二个事件是，集成MRI引导的外部射线放射治疗系统在2014年左右就有可商用的系统了。这些系统可以为基于软组织的病人设置提供MRI扫描，在治疗进行中监控肿瘤的移动。如果可以基于MRI扫描计算剂量分布，而这需要指定电子密度，系统就可以在每个分次治疗中计算并调整剂量分布。放射治疗中MRI越来越受关注，成像设备和治疗设备的引入，在图2中反应在了出版物的数量上。

In this review, we will report on a collection of typical performance values for a number of main approaches encountered in the literature for conversion of MR data to electron density or HU maps relevant for RT. The generated map is called “synthetic CT”, “substitute CT”,”pseudo CT” or similar, i.e. no common terminology is currently established. In the following, we will use the term substitute CT (sCT) since the acronym for pseudo CT (pCT) is often used for the planning CT in adaptive RT studies [19, 20]. This field of research covers both diagnostic and therapeutic radiology as well as MRI. Further, the research field expands into automatic organ segmentation and image analysis in general. As a result, a diverse amount of approaches with different scientific traditions, terminology and endpoints in mind have been reported in the literature. Consequently, we have had to make simplifications and compromise details in order to preserve an overview and to further categorize and score the methods with the aim of providing results relevant for RT. Therefore, a direct comparison between the reported performance metrics presented here is not valid. Rather, the idea is to provide an overview of the multiple strategies investigated in the literature along with a general order of accuracy that can be reached.

本文中，我们对文献中遇到的常见的将MRI数据转化为电子密度或HU图的方法，给出了典型的性能值。生成的图称为合成CT，替代CT，伪CT，或类似的名字，即，目前还没有固定的术语。下面，我们使用替代CT的术语(sCT)，因为在自适应RT研究中，经常使用伪CT的缩写(pCT)。这个研究领域覆盖了诊断放射学和治疗放射学，以及MRI。而且，研究领域扩展到了自动器官分割，和图像分析。结果是，文献中有很多类型的方法，其科学传统不同，术语和终点也不一样。我们要进行简化和折中，以对与放射治疗相关的文献进行分类评分，形成综述。因此，这里没有这些方法的性能直接对比的矩阵。我们的思想是，给出多种策略的概述，以及可以达到的准确率的总体顺序。

We have categorized the investigated methods into three main approaches. These are termed voxel [21–23], atlas [24, 25] and hybrid [26, 27]. The latter use a combination of the voxel and atlas based approach. Similar approaches are typically categories as segmentation, sequence/image contrast, template and atlas in PET/MRI terminology [16, 28]. The voxel based approach primarily uses information about voxel intensities (contrasts) in the MR images to assign electron densities. No or limited information about the location of voxels is included in this category. The voxel based methods are dominated by the concept of machine learning in which part of the data is used to train (optimize) a model which is then applied on the remaining MRI data to predict the CT numbers. If a study contains n patients, this is usually done by training the model on n-1 patients and then predict the sCT on the remaining patient in a rotating scheme known as leave-one-out cross validation. The electron density assignment (CT number) can be made on the basis of generic values (e.g. from ICRU report 46 [29]) to bulk groups of voxels. Alternatively, the assignment can happen on a continuous scale by including patient specific CT numbers in a training phase. In contrast, the atlas based approaches focus on aligning the location of a patients MRI voxels to the corresponding location of a MRI voxels in an atlas through registration. The atlas can either be a single or average (template) patient or contain a number of patients (often termed multi-atlas). The atlas contains a pre-known correlation between the MRI voxels and the value of interest, e.g. CT number or organ label. Once the alignment has taken place, the atlas CT number can be assigned to the patients’ MRI scan and hence converting it into a sCT scan.

我们将现有的方法分成三种类别。体素方法，atlas方法和混合方法。后者使用的是综合的基于体素和atlas的方法。类似的方法在PET/MRI术语中一般分类为分割，序列/图像对比度，模板和atlas。基于体素的方法主要使用了MRI图像中体素亮度的信息，来指定电子密度。在这个类别的方法中，体素的位置信息基本没有使用，或只使用了有限的信息。基于体素的方法中，主要是机器学习的概念，部分数据用来训练（优化）一个模型，然后将这个模型用在剩下的MRI数据中，以预测CT值。如果一个study中包含n个病人，通常是在n-1个病人上训练这个模型，在剩下的那个病人上预测sCT，然后轮流进行，方法称为leave-one-out交叉验证。电子密度的指定（CT值）可以在很多体素的通用值的基础上进行。另外，这个指定也可以在连续尺度上进行，通过在训练阶段就引入病人的特定CT值。对比起来，基于atlas的方法主要是将病人的MRI体素与atlas中对应的MRI体素位置通过配准进行对齐。Atlas可以是单个病人或平均的病人，也可以包含多个病人（称为multi-atlas）。Atlas中包含了MRI体素与感兴趣值（CT值或器官标签）的已知关联。一旦这个对齐完成，可以将atlas CT值指定给病人的MRI扫描，就可以将其转化成一个sCT扫描。

A large number of MRI sequences/contrasts for electron density assignment have been reported in the literature. We have chosen to divide the MR input images into four main contrasts/sequences categories. The first two categories are simply termed T1 weighted (T1w) and T2 weighted (T2w). They are based on common clinical MRI sequences which rely on either the longitudinal (T1) or the transverse (T2 or T2*) tissue relaxation to produce image contrast. The T1 and T2 relaxation is determined from multiple refocusing pulses during the repetition time while T2* describes the relaxation of the free induction decay (FID) produced in the receiver antenna coil. Two main pulse sequences exist for MR image acquisition: spin echo (SE) and gradient echo (GE). The SE MR signal intensity is roughly proportional to ρ[1-exp(TR/T1)]exp(-TE/T2) where ρ (proton density), T1 and T2 are tissue properties and TR (repetition time) and TE (echo time) are sequence parameters. The equation is only valid if TR > > TE which is usually the case, and, in general T1 > T2 > T2* relaxation [30]. T1w images (short TR, short TE) are preferred for visualizing anatomy while T2w images (long TR, long TE) are usually the choice for visualizing pathology. The third category comprises the Dixon family of fat-water separating sequences and is collectively termed Dixon [31]. It is based on the chemical shift between the resonance frequencies of fat and water and can be weighted towards T1, T2 or ρ as it is (typically) a SE sequence. The fourth category of MRI sequences is based on dual ultrashort echo time (dUTE) to visualize solid structures with a very short T2 relaxation time such as the bone [32, 33]. In dUTE image acquisition, a first signal is collected right after the excitation, and a second using the GE technique at a longer nominal echo-time. The first image is ρ weighted or T1w depending on the flip-angle and the second will have a T2*w or T1w contrast depending on the echo-time and the flip-angle. T2 * is only possible to realize with gradient echo sequences.

文献中用了很多MRI序列/对比度来进行电子密度指定。我们将输入的MR图像分成四个主要的对比度/序列类别。前两个类别是T1加权T1w和T2加权T2w的。这都是基于常见的临床MRI序列的，依靠纵向(T1)或横向的(T2或T2*)组织弛豫，以生成图像对比度。T1和T2弛豫是通过在重复时期内多个重新对焦的脉冲确定的，而T2*描述的是接收天线线圈产生的FID的弛豫。MR图像获取中，有两个主要的脉冲序列：spin echo(SE)和gradient echo(GE)。SE MR信号强度大致与ρ[1-exp(TR/T1)]exp(-TE/T2)正比，其中ρ（质子密度），T1和T2是组织的性质，TR(repition time)和TE(echo time)是序列参数。这个等式只在TR > > TE时成立，通常也是这个情况，一般来说T1 > T2 > T2 *。T1w图像更多的用于可视化解剖结构，T2w图像则用于可视化病理更好。第三个类别是区分水和脂肪序列的Dixon族，统称为Dixon。这是基于脂肪和水的共振频率不同，可以用T1，T2或ρ加权为一个SE序列。第四个类别是基于双超短回声(dUTE)的，以可视化固态结构，其T2弛豫时间非常短，比如可以可视化骨骼。在dUTE图像获取中，激励过后，就收集第一个信号，第二个则使用GE的技术，在较长的nomimal echo-time时收集。第一幅图像是ρ加权或T1w的，主要靠翻转角，第二个则有T2 *w or T1w的对比度，依靠echo-time和翻转角。T2 *只可能用梯度echo序列实现。

## 2. Material and methods

### Literature search

This review reports on a collection of typical performance values for substitute CT generation rather than giving a detailed theoretical background of the methods used to predict substitute CT.

本文给出了替代CT生成的典型表现，而没有给出预测替代CT的方法的理论背景。

Scopus search string 254 papers + Author knowledge 7 papers -> Exclusion 1: MRI-only relavant 117 papers -> Ex 2: original method 73 papers ->  Ex 3: MRI-only relavant 50 papers

### Method categories

The methods were organized with subcategories according to a main voxel, atlas or hybrid approach in Table 1. Voxel based sCT generation utilizes the contrast in the MR image independently of the voxels spatial location. This makes it a potential computational attractive approach. The voxels can be converted into CT numbers in multiple ways which we have subcategorized below.

这些方法主要根据表1中的体素、atlas或混合方法分成子类。基于体素的sCT生成利用了MR图像中的对比度，独立于体素的空间位置。这使其计算量较小。可以以多种方式，将体素转化成CT值，这些方法有以下子类。

Semi-automatic refers to some kind of manual intervention from the user to make the method work, e.g. delineation of the bone or manually established intensity thresholds below/above which a voxel is categorized into a certain tissue category.

半自动的方法是指，用户进行某种手工的干预，才能使这个方法起作用，如，骨骼的勾画，或手动确定亮度的阈值，高于/低于这个阈值的体素，将其归类于一定的组织类别。

Threshold covers methods which use the tissue relaxation constant to differentiate between different tissues. For the dUTE sequence/contrast, the T2 relaxation time of the bone (0.5–2ms depending on magnetic field strength) can as an example be used to categorize voxel which decays>1/(0.5–2 ms) into bone and voxels which remain constant (or decay slowly) over the short acquisition time into soft tissue [35].

阈值方法，主要使用组织弛豫常数来区分不同的组织。对于dUTE序列/对比度，骨骼的T2弛豫时间（依磁场强度不同，大约是0.5-2ms），可以作为一个例子，用于归类体素，将衰减>1(0.5-2ms)归类为骨骼，在短的获取时间内为常数（或衰减缓慢）的体素归类为软组织。

Probabilistic refers to methods which can assign a probability of a voxel to belong to different tissue classes with e.g. a corresponding bulk electron density (sCT) or organ label (auto contouring). This could be done by assuming that the MR intensities come from a mixture of K normal distributions (tissue classes) with a corresponding mean and standard deviation. The initial mixture can be estimated with an expectation maximization algorithm through unsupervised training, i.e. an electron density (CT number) is assigned to each tissue class subsequently. For each voxel, a probability can then be calculated for all tissue classes and the voxel can be assigned to the tissue class for which the highest probability was calculated. This is known as Bayesian statistics.

概率类的方法是指，为每个体素指定属于不同组织类别的概率，比如可以使用对应的bulk电子密度(sCT)或器官标签（自动勾画）。假设MR的亮度是K个正态分布（组织类别）的混合，每个正态分布都有对应的均值和标准差。初始的混合可以用无监督训练的期望最大化算法来估计，即，然后给每个组织类别指定一个电子密度(CT number)。对于每个体素，就可以为每种组织类别计算出一个概率，这个体素可以指定给最高概率的组织类别。这就是贝叶斯统计方法。

Markow Random Fields include the tissue classes of neighbor voxels in the probability calculation of a given voxel [22]. Fuzzy c-means clustering use a similar strategy of dividing the MRI voxels into distinct clusters (tissue classes). Cluster similarity coefficients are then calculated for each voxel which is then assigned to the tissue which it resembles the most. A number of different similarity measures exist.

Markov随机场在计算给定体素的概率时，考虑到了临近体素的组织类别。模糊C均值聚类使用类似的策略，将MRI体素分成不同的聚类（组织类别）。然后对每个体素计算聚类相似性系数，然后指定给最接近的那个组织。存在几种不同的相似性度量。

Regression collects methods which correlate MRI intensities to CT numbers through (statistical) regression on a continuous scale. This can be done in a fashion similar to the Bayesian approach here termed Gaussian by including co-registered CT intensities in an initial supervised training phase of the data that establish the prior mixture of the K tissue classes [23].

回归类的方法是，通过统计回归方法，将MRI亮度在连续尺度上与CT值关联起来。其关联的方式，与贝叶斯方法类似，这里称之为Gaussian方法，将联合配准的CT亮度在初始有监督训练阶段就包含进来，数据中有确定好的K个组织类别的先验组合。

Discriminant analysis, Principal Component Analysis and Random Forest are other strategies of performing such a regression between MR and corresponding CT data. Sinogram use a forward projection CT like approach to transform the MRI scan into raw MR data where the different tissues are subsequently identified.

判别性分析，主成分分析和随机森林，是在MR和对应的CT数据中进行这样的回归的其他策略。正弦图方法，使用的是与前向投影CT类似的方法，将MRI扫描转化成原始MR数据，在其中辨别出不同的组织。

Neural network describes supervised training of a correlation model in a hidden layer with an MRI input layer and a CT output layer.

神经网络方法是一种有监督的训练，在隐藏层中训练出一个关联模型，其输入是MRI，输出是CT。

Pattern recognition in a voxel setting compares an MRI pattern, e.g. a cluster of 3x3x3 size MR voxels known as a patch, with a pre-established correlation between MR patterns and CT numbers obtained through supervised training. Different measures for pattern similarity can be used such as the (normalized intensity) Euclidean distance.

体素中的模式识别，将MRI的模式与预先确定的MR模式和CT值关系进行比较，MRI模式如3x3x3大小的MR体素，称为一个块，而其预先确定的关联则是通过有监督训练得到的。可以使用不同的模式相似性度量，如归一化的亮度的欧式距离。

Hybrid voxel methods combine a voxel based method with somewhat loose information of the voxels location, e.g. distance from center of the brain.

混合体素方法将基于体素的方法与体素位置的宽松信息相结合，如，与大脑中心的距离。

Atlas based sCT generation use the location of an MRI voxel to establish the corresponding CT number by aligning the voxel to an atlas with a pre-known correlation between the MRI voxel location and corresponding CT number. This is potentially more computational challenging as each patient's MRI has to be aligned with an atlas with no possibility of exploiting a pre-training model (except for the atlas building). In an atlas setting, Pattern Recognition compares similarities of patient MRI patches (see above) with atlas MRI patches within a limited search volume after alignment. Deformable refers to methods which use deformable registration, i.e. non-rigid registration, to assign CT numbers from an atlas to a given MRI scan. The patient's MRI is first registered non-linearly with the atlas MRI. This could be one registration if the atlas consists of one average or template patient. Otherwise, the MRI has to be individually registered to all MRIs in a multi-atlas which is computationally less attractive. Alternative, one can settle with one (entrance) registration if the multi-atlas is internally registered, i.e. a registration map between the entrance atlas and the other atlases has been pre-established. The deformation map between the patient and atlas MRI is then applied to the corresponding atlas CT and the sCT produced. If multiple atlases are used, a fused CT number can be applied.

基于atlas的sCT生成，通过将体素与atlas用已知的MRI体素位置和对应的CT值关联进行对齐，使用MRI体素的位置信息，来确定对应的CT值。这可能计算量更大一些，因为每个病人的MRI都要与一个atlas进行对齐，而不是使用一个预训练好的模型（除了atlas构建的过程）。在atlas的设置中，模式识别比较病人的MRI块与atlas MRI块的相似度，这是在对齐后，在有限的搜索体中进行的。可变形模型，指的是使用可变形配准的方法，即非刚性配准，来将atlas中的CT值指定给给定的MRI扫描。病人的MRI首先与atlas MRI进行非线性配准。如果atlas只有一个平均病人或模板病人，这就只需要一次配准。否则，如果是multi-atlas的情况，就必须与所有MRI进行独立配准，这样计算量就更大。除此之外，如果multi-atlas是内部对齐的话，就可以只进行一个（入门）配准，内部配准的意思是，在入门atlas和其他atlas之间有预先确定好的配准图。病人和atlas MRI之间的可变形图，然后用于对应的atlas CT和产生的sCT中。如果使用了多个atlas，就应用一个融合的CT值。

Hybrid atlas methods combine multiple methods within the atlas based category. This could be a method which combines deformable registration with a (patch) pattern recognition approach to minimize the influence of registrations which resulted in a poor alignment.

混合atlas方法，将基于atlas的类别中的多个方法进行综合。这可以是可变形配准与块模式识别方法的结合，以最小化配准的影响，因为可能回得到较差的对齐结果。

The final Hybrid approach combines categories of the voxel and atlas based approaches. This could for example be a calculation of two probability density functions (PDFs) for each voxel; one based on deformable registration (atlas) and the other based on Bayesian statistics (voxel). The two probabilities are then combined into a unified posterior PDF which determines the final assignment of CT number to the voxel [26]. An example of atlas and voxel based sCT generation for the pelvis and brain can be seen in Fig. 5.

最后的混合方法，是将基于体素的方法与基于atlas的方法的综合。比如，对每个像素计算两个概率分布函数；一个基于可变形配准(atlas)，另一个基于贝叶斯统计（体素）。这两个概率结合成一个统一的后验PDF，用于确定最终对体素的CT值指定。对盆部和脑部的基于atlas和体素的sCT生成，如图5所示。

### Performance metrics

Three common metrics reported in the literature to score the performance of a given sCT generation method were chosen. The first metric, ΔDose, describes the dosimetric agreement when performing dose calculations on the sCT as compared to the standard CT. This is usually quantified as the percentage difference in either single characteristic points, e.g. iso-center or dose prescription point, or in dose volume histogram (DVH) points. The general equivalent uniform dose (gEUD) has also been used to describe the biologically relevant differences of the entire DVH. Another commonly reported metric for quantifying dosimetric differences is the gamma index [36]. This metric covers spatially correlated dose deviation in both the high and low dose regions. Whenever differences in multiple dose metrics were reported, e.g. multiply DVH points, a collectively representative value, e.g. the mean of all the deviations, was chosen. The second metric is the mean absolute error (MAE) and describes the absolute voxel-wise difference in HU defined as

我们选择了在文献中经常出现的三种度量标准，来对给定的sCT生成算法的性能进行评分。第一个度量标准是ΔDose，描述的是在sCT上计算的剂量，与在标准CT上计算的剂量相比，其剂量的符合率。这个度量通常在单个特征点上量化成百分比的差异，如iso-center或剂量处方点，或在DVH中的点。通用等价统一剂量(gEUD)也用于描述整个DVH点上生物学上相关的差异。另一个经常出现的度量标准，用于量化剂量差异，是gamma index。这个度量标准包括了高剂量区域和低剂量区域中的与空间相关的剂量偏差。不论什么时候给出了多个剂量度量标准，如，多个DVH点，就选择一个最具有代表性的值，如所有偏差的均值。第二个度量标准是MAE，将逐个体素的绝对差异描述为下，以HU为单位：

$$MAE = \frac{1}{N} \sum_{i=1}^N |CT_i - sCT_i|$$

where N is the number of voxels, CT is the standard CT and sCT is the substitute CT. This metric is typically lowered as the number of voxel similar to water or air increases, e.g. moving from the brain to the pelvis or including air outside the body outline (see Fig. 6a). The MAE shows a great variation over the different tissue regions. For the data presented in Fig. 6a, the shown median MAE of 87 HU for all tissue in the skull covers a median MAE of 216, 36 and 261 HU for air, soft tissue and bone, respectively.

其中N是体素的个数，CT是标准CT，sCT是替代CT。在与水或空气类似的体素增多时，这个度量通常会变低，如，从脑部到盆部时，或包含了身体轮廓外的空气时，如图6a。MAE在不同的组织区域中表现出了很大的差异。对于图6a中给出的数据，展示出的中值MAE为87，这是头颅中的所有组织，包含了空气的中值MAE 216，软组织的中值MAE为36，骨骼的中值MAE为261。

The third metric, the dice similarity coefficient (DSC) for bone [37], is a geometric score describing the overlap between the CT and sCT bone volumes. It is defined as

第三个度量标准，骨骼的dice相似性系数(DSC)，是一个几何分数，描述的是CT和sCT中骨骼体的重叠程度。定义为

$$DSC_{bone} = \frac {2(V_{CT} ∩ V_{sCT})} {V_{CT} + V_{sCT}}$$

where V is the volume of the bone on the CT and substitute CT (sCT), respectively. A similar measure, the Jaccard coefficient (JAC) can be converted to the DSC through the relation DSC = 2 · JAC/(1 + JAC) [38]. Another commonly reported metrics is the sCT specificity and sensitivity for different tissues such as the bone. The bone DSC, sensitivity and specificity will depend on the threshold value set for the CT number of the bone (see Fig. 6b and c). Other metrics are otherwise noted in the legend of Table 1.

其中V是在CT和替代CT中骨骼的体积。类似的度量是Jaccard系数，可以转换为DSC，其关系为DSC = 2 · JAC/(1 + JAC)。另一种常见报导的度量标准是，sCT对不同组织的专门性和敏感性，如骨骼。骨骼DSC，敏感性和专门性会依赖于为骨骼设置的CT值的阈值（见图6b和6c）。其他度量标准在表1中有所叙述。

The performance metrics reported in the literature cannot be directly compared due to issues such as patient selection and exclusion criteria which are often underreported and can introduce a bias. Further, the amount of preprocessing included in the algorithm such as data normalization and bias field correction will affect the final result. Still, methods performing equally well in the same body region should produce performance metrics within the same gross interval.

文献中的性能度量标准不能直接进行对比，由于病人选择和排除的规则通常没有报导，这会带来偏差。而且，算法中包含的预处理，如数据归一化和偏置场修正，会影响最终结果。尽管如此，在同样的身体区域表现的一样好的方法，得到的性能度量应当在大致相同的区间。

## 3. Results

The statistics reported in Fig. 2 and Fig. 3 indicate that most studies are carried out on the brain for 5-10 patients with PET/MR applications in mind using a voxel based method. It is common to use model input data that coincide with the image data used for the delineation of the target volume or organs at risk. The main benefits are avoidance of unnecessary registrations in the workflow to compensate for intra examination patient motion and to keep the examination time as short as possible. Therefore evaluation of T1w input data is common for the brain region, while T2w input data is common for the pelvic region. dUTE has the benefit of enabling separation of cortical bone and air, but has not been reported useful for delineation purposes. Our review shows that at present point dUTE has only been evaluated for intra-cranial conditions or phantoms (Table 1). Dixon based sequences enable separation of water and fat signal, and is currently often used for attenuation correction of PET data in hybrid PET/MR scanners. Dixon sequences also tend to be fast and the in-phase sequence has been reported useful for identification of fiducial makers in the prostate [39]. Table 1 shows a wide diversity in terms of the methods and MRI sequences investigated in the literature. Overall, the dosimetric agreement is in the order of 0.3–2.5%. A strict gamma criterion of 1% and 1mm has a range of passing rates from 68 to 94% while less strict criteria show pass rates > 98%. Given the relatively small order of dosimetric disagreement, the residual distortion (i.e. remaining distortion after applying distortion correction procedures) present in the MR and hence sCT images subject to dose calculations seem to be of minor importance in order to reach an acceptable dosimetric accuracy. Rather, these seem to be more critical for accurate target and OAR delineation [40]. The MAE is between 80 and 200 HU for the brain with a majority of values lying in the 120–140 HU interval. The MAE values are around 40 HU for the prostate (pelvis region). The Dice score for bone is between 0.5 and 0.95 across the different methods, MRI sequences/contrasts and anatomical sites. The specificity and sensitivity range from 75 to 98%. As is apparent from Fig. 6c, increasing the specificity will decrease the sensitivity and vice versa. A compromise seems to be in the upper 80s for both quantities. Correctly classified voxels average around 84% for the different methods. No strict relationship between the dosimetric and geometric agreement as scored by the metrics common in the literature is present. Further, when a large number of patients are present in a study, i.e. more than 20 patients, the dice score seem to be in the lower range (<0.85) of the reported values probably caused by a larger diversity in the patient material.

图2和图3中的统计表明，多数研究都是在脑部进行，采用5-10病人在PET/MR的图像，使用的是基于体素的方法。模型使用的输入数据，与用于目标体挥或危及器官的勾画使用的图像数据相一致，这很常见。主要的好处是在工作流中不需要进行不必要的配准，以补偿检查中的病人运动，使检查的时间越短越好。因此，对脑部区域，常见的是对T1w输入数据的评估；在盆部区域，常见的是T2w数据。dUTE的优势是可以区分骨密质和空气，但还没有报导过对勾画有用处。本文表明，目前dUTE仅用于颅内的情况或模体（表1）。基于Dixon的序列可以将水和脂肪信号分开，目前通常用于混合PET/MR扫描中的PET数据的衰减修正。Dixon序列通常还很快，阶段内的序列对识别前列腺中的基准信标点。表1表明，文献中研究的方法和MRI序列多种多样。总体上，剂量差异是在0.3-2.5%的水平。采用比较严格的gamma准则，即1%和1mm，其通过率为68%-94%，而不太严格的准则下，通过率则大于98%。给定相对较小的剂量差异，剩余的形变（即，在进行过变形修正过程后的，剩余形变），在MR和sCT中，对剂量计算的影响，在达到可接受的剂量准确率上，似乎重要性很小。但这对于准确的目标和OAR勾画似乎更为关键。对于脑部，其MAE在80到200HU之间，大部分值在120-140HU的值之间。MAE值对于前列腺（盆部）区域大约是40HU。骨骼的dice分数，在不同的方法中、不同的MRI序列/对比度，和不同的解剖部位时，是在0.5到0.95之间。专门度和敏感度在75%到98%之间。从图6c中，可以很明显看到，增加专门度会降低敏感度，反之亦然。在上部80%时，似乎达到较好的折中。对于不同的方法，正确分类的体素数大约在84%左右。文献中常用的方法中，其几何吻合度和剂量吻合度之间没有严格的关系。而且，当一个study中有很多病人时，如超过20个人，dice系数似乎会较低（<0.85），这可能是由于病人的多样性导致的。

## 4. Discussion

Table 1 is not a complete list of all methods used for generating a sCT, due to the search strategy, time of search and exclusion criteria applied, some novel methods such as sparse representation [41] and Random Forest with auto-context modelling [42, 43] are not included. With these limitations in mind, our investigation shows that sCT generation for MRI-only based radiotherapy or PET/MRI attenuation correction seems to be a comprehensively tested area of research given the variety of investigated methods which are able to produce a sCT from an MRI scan. This presents an advantage in the sense that a broad material is currently available to further develop on. This strength, however, also presents a challenge for the field. There is no obvious method or MRI contrast(s) which seem to be clearly favorable from the others and hence no clear indication as to which path of promising methods to pursue. The data in Table 1 do not indicate that inclusion of more MR contrasts in the generation of the sCT automatically increase the accuracy. This is encouraging as extra sequences both increase the total acquisition time and overall complexity of the method and the workflow. Notably, the dice score of the voxel hybrid approaches using Random Forest (Random F) in Table 1 creates an almost perfect overlap between CT and sCT bone volumes especially considering the high threshold of 600 HU applied in these studies (see Fig. 6b). These reported results should encourage other researchers to reproduce this method on different datasets especially since a pure Random F approach on dUTE images does not produce similar high performance scores. The average dosimetric deviations reported in Table 1 should be used with some caution. Korsholm et al. reported on dose deviations using bulk density corrections for multiple treatment sites [44]. With a bulk density correction for the bone, the average deviation for median PTV dose of the prostate was practically zero but covers a range of -1.1 to 1.1% representing the 95% confidence interval. They further argued that the 95% confidence interval should be within a 2% dosimetric deviation to produce clinical acceptable results.

表1中没有包含所有的生成sCT的方法，由于搜索策略，搜索时间和排除规则的原因，一些新颖的方法没有包含进去。我们的调查表明，sCT生成以进行只用基于MRI的放射治疗或PET/MRI衰减修正，似乎是一个进行了广泛测试的研究领域，因为研究的众多方法都可以从MRI扫描中生成sCT。这带来了一个优势，还可以研究很多种材料。这也给这个领域带来了一种挑战。没有明显特别好的方法或MRI对比，所以要进一步研究哪个方向并不明确。表1中的数据并没有表明，在生成sCT的过程中，引入更多的MRI对比，会自动增加生成的准确率。这是好消息，因为额外的序列会增加总计的图像获取时间和方法、工作流的总复杂度。值得注意的是，表1中使用随机森林的体素混合方法的dice系数，得到了几乎完美的骨骼CT和sCT的重叠，尤其是考虑到在这些study中使用的很高的阈值600HU（见图6b）。这些得到的结果应该可以鼓励研究者在不同的数据集上复现这些结果，尤其是因为纯随机森林的方法在dUTE图像中没有得到类似的很好的结果分数。在表1中的平均剂量偏差，应当谨慎使用。Korsholm等使用bulk密度修正在多个治疗位置给出了剂量偏差。对于骨骼中的bulk密度修正，前列腺的中值PTV剂量的平均偏差实际上是0，但实际覆盖了-1.1%到1.1%的范围，表示了95%的置信度区间。他们进一步提出，95%的置信度区间应当在2%的剂量偏差内，以得到临床上可接受的结果。

The focus of the present review is the conversion of image data acquired with MRI to electron density or HU maps to facilitate a so called MR-only treatment planning workflow. In addition and not limited to the MR-only approach, use of MR in radiotherapy requires MR data with a minimum of geometrical distortions. It has been shown that distortions due to non-linearity in the spatial encoding gradients can be successfully corrected using deterministic algorithms [45], and chemical shift artifacts and distortions caused by susceptibility effects can be minimized using a sufficient bandwidth [46]. There is, however, still a need to further confirm these results and develop efficient quality control techniques, but this is out of the scope of the current review.

本文关注的是图像数据的转换，从MRI到电子密度或HU图，以促进所谓的MRI-only治疗计划工作流。除了MR-only的方法，MR在放射治疗中的应用需要MR数据的几何变形要尽量的小。已经表明，由于空间编码梯度中非线性导致的变形，可以使用判别式算法成功修正，化学物质变化伪影和变形可以通过充分的带宽得到最小化。但是，仍然需要确认这些结果，提出高效的质量控制技术，但这超出了本文的范畴。

### Standardization

One could argue for a need to unify the efforts to localize promising candidate for sCT generation. A possible way is to standardize the calculation of the performance metrics reported in the literature. It is clear from Fig. 6 that the MAE, DSC_{bone}, specificity and sensitivity metrics have their limitations and further do not necessarily reflect the corresponding dosimetric performance of the method. Quantitative metrics that more unambiguously reflect a correlation between the geometrical and dosimetrical agreement are needed and these should further display an independence of parameters such as selected CT number threshold and field-of-view. An example could be to score the sCT-CT difference in bins covering the HU scale independent of the number of voxel present in each bin [47]. Another example could be to use differences in radiologic (water equivalent) path lengths which represent both a geometric and dosimetric property [48, 49]. The accuracy of the performance metric should further be related to the application in question, e.g. RT or PET/MRI. To benchmark results, another possible way would be to make datasets consisting of MRI scans with a variety of contrasts and corresponding CT scans for different anatomical sites public available. Such a dataset currently exists for quantitative imaging of biomarkers [50] and a similar dataset for sCT generation could serve as a mandatory step for method benchmarking before publication. Issues related to the algorithms processing of MRI signal normalization and correction would further become apparent on such a dataset. Currently, many studies only benchmark the sCT against the gold standard CT. In addition, a dosimetric comparison between a proposed method and the investigated MRI scan(s) set to water should be included in a study to give a perspective of the reported quantities. Another issue is a number of relevant items which are often not addressed. These cover inclusion or exclusion criteria for the investigated patients which could create a bias, computation time needed for a given method to work and restrictions in the possible clinical implementation of the method.

统一sCT生成的方法，有这个需求。一种可能的方法是，对文献中给出的性能度量标准的计算进行标准化。从图6中可以明显看出，MAE，DSC_{bone}，专门性和敏感性矩阵都有其局限，不一定反应的是其方法的剂量表现。更加毫无疑议的反应几何和剂量吻合性关联的定量矩阵，这是需要的，而且应当与一些参数无关，如选择的CT值阈值和视野。一个例子是，对sCT-CT的差异以bins进行评分，覆盖HU的尺度，与每个bin中的体素数量无关。另一个例子是，使用放射学中（水等价的）路径长度，这同时代表了几何和剂量性质。性能度量标准的准确性，还应当与考虑中的应用相关，如放射治疗，或PET/MRI。为对结果进行基准测试，另一种可能的方法是制作MRI数据集，包含很多的对比度，和对应的CT扫描，而且还要包括各个部位的，使其公开可用。这样一个数据集目前在生物标记的定量成像中是可用的，为sCT准备类似的数据集，可以作为文章发表之前，进行方法标准测试的强制步骤。与处理MRI信号归一化和修正的算法问题，在这个数据集上会变得更加明显。目前，很多研究都将sCT与金标准CT相比较。另外，提出的方法的和研究的MRI扫描的剂量对比，应当包含在研究中，以给出量化的图。另一个问题是，有一些相关的问题通常没有涉及到。这包括研究的病人的选择标准或排除标准，这会带来偏差，给定方法的计算时间，一种方法临床实现的可能限制。

### Clinical implementation

So far, the authors are aware of two institutes which currently have implemented in-house developed MRI-only methods clinically. The first institute use a voxel based dual regression approach on the prostate and have currently treated around 150 patients [21, 51]. The second institute use a voxel based probabilistic approach with fuzzy c-means on the brain and have currently treated around 30 whole brain and 15 focal brain cases, respectively [52]. Further, commercial solutions for sCT generation are becoming available [27, 53]. Stereotactic radiosurgery treatment planning of brain tumors have been carried out on MRI scans set to water for decades [54]. Brain radiosurgery was outside the scope of this review but one could question this practice given published literature which demonstrates an improvement in dosimetric accuracy as compared to a pure water based dose calculation for the brain, see e.g. [55]. For the brain and other treatment sites, it has further been shown that a bulk density assignment is probably sufficient for RT treatment planning [44, 56].

迄今为止，我们知道有两个机构临床实现了MRI-only的方法。第一个机构使用的是基于体素的双回归方法，使用在前列腺部位，目前大约治疗了150个病人。第二个机构使用的是基于体素的概率方法，使用的是模糊c-均值，应用在脑部，目前治疗了大约30个全脑和15个脑局部。而且，已经有可商用的sCT生成解决方案。在MRI扫描上进行脑肿瘤的SBRT治疗计划已经有十几年了。脑部放射外科不在本文研究范围内。对于脑部和其他治疗部位，已经进一步表明，进行bulk密度指定，就可能足以进行放射治疗计划。

Treatment delivery and quality assurance (QA) of an MRI-only based RT workflow are other important issues which need to be addressed for clinical implementation of MRI-only RT. In terms of commissioning an MRI-only workflow, the guidelines as to what tolerances which are acceptable are limited. As mentioned earlier, a 2% dosimetric agreement between sCT and CT based dose calculation seems to be of an acceptable order [44] and most of the investigated methods demonstrate an agreement better than this. For kV X-ray based image-guided RT (IGRT) delivery systems, the cone beam CT (CBCT) seems to provide an acceptable solution for patient setup of both brain and pelvic patients (marker match is probably sufficient for prostate) [47, 57, 58]. The CBCT can further be used for patient specific QA of the generated sCT as it provides an independent estimate of the CT numbers [47]. sCT QA verification efforts using the electronic portal imaging device (EPID) has also been proposed [53]. All of the above elements should be considered when formulating an MRI-only based RT protocol.

基于MRI-only RT工作流的治疗进行和质量保证是其他很重要的问题，在临床实现MRI-only RT时需要解决。之前提到过，基于sCT和CT的剂量计算，有2%的剂量误差似乎是可接受的，多数调查的方法表明会比这个效果更好。对于kV X射线的IGRT投放系统，CBCT似乎可以提供可接受的解决方案，以进行脑部和盆部的病人治疗（对于前列腺来说，标记点匹配似乎就足够了）。CBCT还能用于特定病人生成的sCT的QA，因为其提供了CT值的独立估计。使用EPID进行sCT QA验证也有这样的工作。在形成基于MRI-only的放射治疗协议时，所有上面的元素都应当被考虑到。

## 5. Conclusions

In summary, a variety of promising approaches for substitute CT generation exist which seem to provide results acceptable for clinical implementation. This also includes methods based on clinical simple standard MRI sequences/contrasts. However, the field suffers from a current lack of an established benchmarking method and reporting consistency, which challenge the commitment from interested vendors and hence risk a delay for a broad clinical implementation.

总结起来，生成sCT有很多有希望的方法，似乎得到了临床实现可以接受的结果。这也包括了基于临床简单标准MRI序列/对比度的方法。但是，这个领域目前缺少固定的基准测试方法和报告一致性。

### Endnotes

In photon-based RT, the main interest is to convert the CT number (HU) into an electron density (relative to water) for dose calculation purposes. Therefore, CT number and electron density is used interchangeable throughout the text.

在基于光子的放射治疗中，主要的兴趣点在于将CT值转化成电子密度（相对于水），以进行剂量计算。因此，CT值和电子密度在本文中可以互换使用。